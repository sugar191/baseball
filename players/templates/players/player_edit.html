{% extends 'base.html' %}
{% load format_filters %}

{% block title %}{{ player.name }} を編集{% endblock %}

{% block content %}
    <form method="post">
        {% csrf_token %}
        <table>
            <tr>
                <td>{{ form.name.label_tag }}</td>
                <td>{{ form.name }}</td>
            </tr>
            <tr>
                <td>{{ form.furigana.label_tag }}</td>
                <td>{{ form.furigana }}</td>
            </tr>
            <tr>
                <td>{{ form.nickname.label_tag }}</td>
                <td>{{ form.nickname }}</td>
            </tr>
            <tr>
                <td>{{ form.birthday.label_tag }}</td>
                <td>{{ form.birthday }}</td>
            </tr>
            <tr>
                <td>{{ form.place.label_tag }}</td>
                <td>{{ form.place }}</td>
            </tr>
            <tr>
                <td>{{ form.height.label_tag }}</td>
                <td>{{ form.height }}cm</td>
            </tr>
            <tr>
                <td>{{ form.weight.label_tag }}</td>
                <td>{{ form.weight }}kg</td>
            </tr>
            <tr>
                <td>{{ form.is_married.label_tag }}</td>
                <td>{{ form.is_married }}</td>
            </tr>
            <tr>
                <td>{{ form.partner.label_tag }}</td>
                <td>{{ form.partner }}</td>
            </tr>
            <tr>
                <td>{{ form.hobby.label_tag }}</td>
                <td>{{ form.hobby }}</td>
            </tr>
            <tr>
                <td>{{ form.specialty.label_tag }}</td>
                <td>{{ form.specialty }}</td>
            </tr>
            <tr>
                <td>{{ form.throwing_hand.label_tag }}</td>
                <td>{{ form.throwing_hand }}{{ form.batting_hand }}</td>
            </tr>
            <tr>
                <td>{{ form.main_position_category.label_tag }}</td>
                <td>{{ form.main_position_category }}</td>
            </tr>
            <tr>
                <td>{{ form.favorite_team.label_tag }}</td>
                <td>{{ form.favorite_team }}</td>
            </tr>
            <tr>
                <td>{{ form.wikipedia_parameter.label_tag }}</td>
                <td>{{ form.wikipedia_parameter }}</td>
            </tr>
            <tr>
                <td>{{ form.usukoi_parameter.label_tag }}</td>
                <td>{{ form.usukoi_parameter }}</td>
            </tr>
            <tr>
                <td>{{ form.youtube_parameter.label_tag }}</td>
                <td>{{ form.youtube_parameter }}</td>
            </tr>
            <tr>
                <td>{{ form.remarks.label_tag }}</td>
                <td>{{ form.remarks }}</td>
            </tr>
        </table>
        {{ formset.management_form }}
        <table>
            {% for record_form in formset %}
                <tr>
                    <td>{{ record_form.id }}</td>
                    <td>{{ record_form.year }}年</td>
                    <td>{{ record_form.salary }}</td>
                    <td>{{ record_form.currency }}</td>
                    <td>{% if record_form.DELETE %}削除: {{ record_form.DELETE }}{% endif %}</td>
                </tr>
            {% endfor %}
        </table>
        <button type="submit">保存</button>
    </form>
    <a href="{% url 'player_detail' player.pk %}">戻る</a>
{% endblock %}
{% block extra_js %}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const marriedSelect = document.getElementById("id_is_married");
            const partnerInput = document.getElementById("id_partner");

            function togglePartner() {
                if (marriedSelect.value === "True") {
                    partnerInput.disabled = false;
                } else {
                    partnerInput.disabled = true;
                    partnerInput.value = "";
                }
            }

            togglePartner();  // 初期状態でも実行
            marriedSelect.addEventListener("change", togglePartner);
        });

        document.addEventListener("DOMContentLoaded", function () {
            const birthdayInput = document.getElementById("id_birthday");
            const yearInput = document.getElementById("id_birth_year");
            const monthInput = document.getElementById("id_birth_month");

            function updateYearAndMonth() {
                const dateValue = birthdayInput.value;
                if (dateValue) {
                    const date = new Date(dateValue);
                    if (!isNaN(date)) {
                    yearInput.value = date.getFullYear();
                    monthInput.value = date.getMonth() + 1;  // 月は0始まりなので+1
                    }
                }
            }

            // 日付が変更されたときに発火
            birthdayInput.addEventListener("change", updateYearAndMonth);
        });
    </script>
{% endblock %}