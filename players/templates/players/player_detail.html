{% extends 'base.html' %}
{% load format_filters %}

{% block title %}{{ player.name }}{% endblock %}

{% block content %}
    <div class = "player-card">
        <div class="page_title">{{ player.name }}</div>
        {% if player.furigana %}
            <div>ふりがな: {{ player.furigana }}</div>
        {% endif %}
        {% if player.nickname %}
            <div>通称: {{ player.nickname }}</div>
        {% endif %}
        {% if player.main_position_category %}
            <div>ポジション: {{player.main_position_category }}</div>
        {% endif %}
        {% if player.birthday %}
            <div>誕生日: {{ player.birthday }}</div>
        {% endif %}
        {% if player.age %}
            <div>年齢: {{ player.age }} 歳</div>
        {% endif %}
        {% if player.place %}
            <div>出身地: {{ player.place }}</div>
        {% endif %}
        {% if player.height %}
            <div>身長: {{ player.height|format_decimal_trim }} cm</div>
        {% endif %}
        {% if player.weight %}
            <div>体重: {{ player.weight|format_decimal_trim }} kg</div>
        {% endif %}
        {% if player.throw_bat %}
            <div>投打: {{ player.throw_bat }}</div>
        {% endif %}
        {% if player.favorite_team %}
            <div>ファン球団: {{ player.favorite_team }}</div>
        {% endif %}
        {% if player.hobby %}
            <div>趣味: {{ player.hobby }}</div>
        {% endif %}
        {% if player.specialty %}
            <div>特技: {{ player.specialty }}</div>
        {% endif %}
        {% if player.is_married %}
            <div>婚姻: {{ player.marriage }}</div>
        {% endif %}
    </div>
    {% if careers %}
        <div class = "custom-heading">経歴</div>
        <table>
            <tbody>
                {% for career in careers %}
                    <tr>
                        <td>{{ career.career_version.name }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
    {% if drafts %}
        <div class = "custom-heading">ドラフト</div>
        <table>
            <tbody>
                {% for draft in drafts %}
                    <tr>
                        <td>{{ draft.draft.year }}年</td>
                        <td>{{ draft.draft.draft_category }}</td>
                        <td class="center"><img src="{{ draft.team.logo.url }}" alt="Team Logo" height="25"></td>
                        <td class="numeric">{{ draft.rank }}位</td>
                        <td class="center">{{ draft.is_hit|hit_mark }}</td>
                        <td class="center">{{ draft|join_mark }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
    <div class = "custom-heading">タイトル</div>
    <table>
        <tbody>
            {% for title in titles %}
                <tr>
                    <td>{{ title.year }}年</td>
                    <td class="center">
                        {% if title.position.id %}
                            {% with label_list=position_labels|dict_get:title.position.id %}
                                <span class="position-badge {{ label_list.1 }}">{{ label_list.0 }}</span>
                            {% endwith %}
                        {% endif %}
                    </td>
                    <td>{{ title.title }}</td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="3">無し</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    {% if commons %}
        <div class = "custom-heading">共通情報</div>
        <table>
            <thead>
                <tr>
                    <th>年</th>
                    <th>球団</th>
                    <th>背番号</th>
                    <th>年俸</th>
                </tr>
            </thead>
            <tbody>
                {% for common in commons %}
                    <tr>
                        <td><a href="{% url 'player_year_detail' player.id common.year %}">{{ common.year|format_year:mlb_exists }}</a></td>
                        <td class="center">
                            <div class="team-logo">
                                {% if common.team.logo %}
                                    <img src="{{ common.team.logo.url }}" alt="Team Logo" height="25">
                                {% else %}
                                    {{ common.team.league.organization }}
                                {% endif %}
                            </div>
                        </td>
                        <td class="center">{{ common.number }}</td>
                        <td class="numeric">
                            {% if common.salary %}
                                {{ common.salary|format_salary }}{{ common.currency }}
                            {% else %}
                                未登録
                            {% endif %}
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="3">無し</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
    {% if pitchings %}
        <div class = "custom-heading">投手成績</div>
        <table>
            <tbody>
                {% for pitching in pitchings %}
                    <tr>
                        <td><a href="{% url 'player_year_detail' player.id pitching.year %}">{{ pitching.year|format_year:mlb_exists }}</a></td>
                        {% if pitching.games != 0 %}
                            <td class="numeric">{{ pitching.earned_run_average|format_pitching_average }}</td>
                            <td class="numeric">{{ pitching.wins|format_integer }}勝</td>
                            <td class="numeric">{{ pitching.loses|format_integer }}敗</td>
                            <td class="numeric">{{ pitching.saves|format_integer }}S</td>
                            <td class="numeric">{{ pitching.holds|format_integer }}H</td>
                            <td class="numeric">{{ pitching.strike_outs|format_integer }}奪</td>
                        {% else %}
                            <td colspan=6 class="center">記録無し</td>
                        {% endif %}
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="6" class="center">データがありません</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
    {% if battings %}
        <div class = "custom-heading">打者成績</div>
        <table>
            <tbody>
                {% for batting in battings %}
                    <tr>
                        <td><a href="{% url 'player_year_detail' player.id batting.year %}">{{ batting.year|format_year:mlb_exists }}</a></td>
                        {% if batting.plate_appearances != 0 %}
                            <td class="numeric">{{ batting.batting_average|format_batting_average }}</td>
                            <td class="numeric">{{ batting.home_runs|format_integer }}本</td>
                            <td class="numeric">{{ batting.runs_batted_in|format_integer }}点</td>
                            <td class="numeric">{{ batting.stolen_bases|format_integer }}盗</td>
                            <td class="numeric">{{ batting.hits|format_integer }}安打</td>
                        {% else %}
                            <td colspan=5 class="center">記録無し</td>
                        {% endif %}
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="6" class="center">データがありません</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
    {% if fieldings %}
        <div class = "custom-heading">守備成績</div>
        <table>
            <tbody>
                {% for year, data in fieldings.items %}
                    <tr>
                        <td><a href="{% url 'player_year_detail' player.id year %}">{{ year|format_year:mlb_exists }}</a></td>
                        {% if data.total_games != 0 %}
                            <td>{{ data.html|safe }}</td>
                        {% else %}
                            <td class="center">記録無し</td>
                        {% endif %}
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="6" class="center">データがありません</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
    {% if classmates %}
        <div class = "custom-heading">同学年</div>
        <table>
            <tbody>
                {% for classmate in classmates %}
                    <tr>
                        <td>
                            {% if classmate.team_logo %}
                                <img src="{{ classmate.team_logo.url }}" alt="Team Logo" height="25">
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            {% if classmate.common_record_registered_name %}
                                {{classmate.common_record_registered_name}}
                            {% else %}
                                {{classmate.player_name}}
                            {% endif %}
                        </td>
                        <td>
                            {% if classmate.player_draft_rank %}
                                {{classmate.draft_year}}年 {{classmate.draft_category_name}} {{classmate.player_draft_rank}}位
                            {% endif %}
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="6" class="center">データがありません</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
    {% if same_time_joined %}
        <div class = "custom-heading">同期入団</div>
        <table>
            <tbody>
                {% for player in same_time_joined %}
                    <tr>
                        <td>
                            {% if player.team_logo %}
                                <img src="{{ player.team_logo.url }}" alt="Team Logo" height="25">
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>{{player.common_record_registered_name}}</td>
                        <td>
                            {% if player.player_draft_rank %}
                                {{player.draft_year}}年 {{player.draft_category_name}} {{player.player_draft_rank}}位
                            {% endif %}
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="6" class="center">データがありません</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
    <a href="{% url 'player_list' %}">戻る</a>
    {% if user.is_authenticated and user.is_superuser %}
        <a href="{% url 'player_edit' player.id %}">[編集]</a>
    {% endif %}
{% endblock %}